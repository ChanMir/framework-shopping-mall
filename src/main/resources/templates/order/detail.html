<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="fregments/header :: head"></head>

<body>

<!-- 공통 네비게이션 -->
<th:block th:replace="fregments/header :: header"></th:block>

<div class="container mt-5 mb-5">

    <div class="card shadow-sm">
        <div class="card-body">

            <h2 class="mb-4 border-bottom pb-2">주문 상세</h2>

            <!-- 주문 기본 정보 -->
            <div class="row mb-4">

                <div class="col-md-6">
                    <p><strong>주문 번호:</strong>
                        <span th:text="${order.id}"></span>
                    </p>

                    <p><strong>주문 금액:</strong>
                        <span class="fw-bold text-danger" th:text="|${order.totalPrice}원|"></span>
                    </p>
                </div>

                <div class="col-md-6">
                    <p><strong>주문 상태:</strong>
                        <span class="badge bg-primary" th:text="${order.status}"></span>
                    </p>

                    <p><strong>주문 일자:</strong>
                        <span th:text="${#temporals.format(order.orderDate, 'yyyy-MM-dd HH:mm')}"></span>
                    </p>
                </div>

            </div>

            <hr class="mt-4">

            <!-- 결제 정보 -->
            <h4 class="mt-3 mb-3">결제 정보</h4>

            <div th:if="${payment != null}">

                <p>
                    <strong>결제 수단:</strong>
                    <span th:switch="${#strings.toUpperCase(payment.method.toString())}">
                        <span th:case="'CREDIT_CARD'">신용카드</span>
                        <span th:case="'BANK_TRANSFER'">계좌이체</span>
                        <span th:case="'KAKAO_PAY'">카카오페이</span>
                        <span th:case="'NAVER_PAY'">네이버페이</span>
                        <span th:case="'PAYCO'">페이코</span>
                        <span th:case="*">기타</span>
                    </span>
                </p>

                <p>
                    <strong>결제 상태:</strong>
                    <span th:switch="${#strings.toUpperCase(payment.status.toString())}">
                        <span th:case="'SUCCESS'" class="badge bg-success">결제 완료</span>
                        <span th:case="'FAILED'" class="badge bg-danger">결제 실패</span>
                        <span th:case="'PENDING'" class="badge bg-warning text-dark">대기중</span>
                        <span th:case="*" class="badge bg-secondary">알 수 없음</span>
                    </span>
                </p>

                <p>
                    <strong>결제 시간:</strong>
                    <span th:text="${#temporals.format(payment.paidAt, 'yyyy-MM-dd HH:mm')}"></span>
                </p>

            </div>

            <div th:if="${payment == null}" class="alert alert-warning mt-3">
                아직 결제 정보가 없습니다.
            </div>

            <hr>

            <!-- 배송 정보 -->
            <h4 class="mt-4 mb-3">배송 정보</h4>

            <div th:if="${delivery != null}">

                <p><strong>배송지:</strong>
                    <span th:text="${delivery.address}"></span>
                </p>

                <p><strong>송장번호:</strong>
                    <span th:if="${delivery.trackingNo != null}"
                          th:text="${delivery.trackingNo}"></span>
                    <span th:if="${delivery.trackingNo == null}">등록되지 않음</span>
                </p>

                <p><strong>배송 상태:</strong>
                    <span th:switch="${delivery.state.toString()}">

                        <span th:case="'PREPARING'" class="badge bg-secondary">상품 준비중</span>
                        <span th:case="'preparing'" class="badge bg-secondary">상품 준비중</span>

                        <span th:case="'SHIPPING'" class="badge bg-info text-dark">배송 중</span>
                        <span th:case="'shipping'" class="badge bg-info text-dark">배송 중</span>

                        <span th:case="'DELIVERED'" class="badge bg-success">배송 완료</span>
                        <span th:case="'delivered'" class="badge bg-success">배송 완료</span>

                        <span th:case="'CANCELED'" class="badge bg-danger">배송 취소</span>
                        <span th:case="'canceled'" class="badge bg-danger">배송 취소</span>

                        <span th:case="*" class="badge bg-light text-dark">알 수 없음</span>
                    </span>
                </p>

            </div>

            <div th:if="${delivery == null}" class="alert alert-warning">
                배송 정보가 아직 등록되지 않았습니다.
            </div>

            <hr>

            <!-- 주문 상품 리스트 -->
            <h4 class="mt-4 mb-3">주문 상품</h4>

            <table class="table table-bordered table-hover text-center align-middle">
                <thead class="table-light">
                <tr>
                    <th>상품명</th>
                    <th width="120">수량</th>
                    <th width="200">주문 금액</th>
                </tr>
                </thead>

                <tbody>
                <tr th:each="item : ${order.items}">
                    <td th:text="${item.product.name}"></td>
                    <td th:text="${item.quantity}"></td>
                    <td class="fw-bold text-danger"
                        th:text="|${item.price * item.quantity}원|"></td>
                </tr>
                </tbody>
            </table>


            <div class="mt-4">
                <a th:href="@{/order}" class="btn btn-secondary">
                    ← 주문 목록으로 돌아가기
                </a>
            </div>

            <div th:if="${order.status.toString() == 'PENDING'
         or order.status.toString() == 'CONFIRMED'}">
                <form th:action="@{'/order/' + ${order.id} + '/cancel'}" method="post"
                      onsubmit="return confirm('정말 주문을 취소하시겠습니까?');">
                    <button class="btn btn-danger mt-3">주문 취소</button>
                </form>
            </div>


        </div>
    </div>

</div>

<!-- 공통 푸터 -->
<th:block th:replace="fregments/footer :: footer"></th:block>

</body>
</html>
